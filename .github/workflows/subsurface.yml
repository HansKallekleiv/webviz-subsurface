name: webviz-subsurface

on:
  push:
  pull_request:
    branches:
      - master
  release:
    types:
      - published
  schedule:
    # Run CI daily and check that tests are working with latest dependencies
    - cron:  '0 0 * * *'

jobs:
  webviz-subsurface:
    # Run on all events defined above, except pushes which are neither to master nor with a substring [deploy test] in commit message
    if: github.event_name != 'push' || github.ref == 'refs/heads/master' || contains(github.event.head_commit.message, '[deploy test]')
    runs-on: ubuntu-latest
    env:
      PYTHONWARNINGS: default  # We want to see e.g. DeprecationWarnings
    strategy:
      fail-fast: false
      matrix:
        python-version: ['3.6', '3.7', '3.8']

    steps:

    - name: üßπ Remove unused pre-installed software
      run: |
        # https://github.com/actions/virtual-environments/issues/751
        # https://github.com/actions/virtual-environments/issues/709
        sudo apt-get purge p7zip* yarn ruby-full ghc* php7*
        sudo apt-get autoremove
        sudo apt-get clean
        df -h

    - name: üìñ Checkout commit locally
      uses: actions/checkout@v2

    - name: üêç Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: ü§ñ Clone default compression
      run: |
        git clone --depth 1 --branch $TESTDATA_REPO_BRANCH https://github.com/$TESTDATA_REPO_OWNER/webviz-subsurface-testdata.git
        rm -rf webviz-subsurface-testdata
      

    - name: ü§ñ Clone no compression
      run: |
        git config --global core.compression 0
        git clone --depth 1 --branch $TESTDATA_REPO_BRANCH https://github.com/$TESTDATA_REPO_OWNER/webviz-subsurface-testdata.git
        rm -rf webviz-subsurface-testdata


    - name: ü§ñ Clone full compression
      run: |
        git config --global core.compression 9
        git clone --depth 1 --branch $TESTDATA_REPO_BRANCH https://github.com/$TESTDATA_REPO_OWNER/webviz-subsurface-testdata.git
        rm -rf webviz-subsurface-testdata